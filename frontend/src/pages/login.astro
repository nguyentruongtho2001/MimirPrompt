---
// Login Page
---

<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Đăng nhập | MimirPrompt Admin</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
    </head>
    <body>
        <div class="login-container">
            <!-- Background Effects -->
            <div class="bg-effects">
                <div class="gradient-orb orb-1"></div>
                <div class="gradient-orb orb-2"></div>
                <div class="gradient-orb orb-3"></div>
            </div>

            <!-- Login Card -->
            <div class="login-card">
                <div class="login-header">
                    <div class="logo">
                        <span class="logo-icon">✨</span>
                        <h1>MimirPrompt</h1>
                    </div>
                    <p class="subtitle">Đăng nhập vào Admin Panel</p>
                </div>

                <!-- Alert -->
                <div id="alertContainer" class="alert-container"></div>

                <!-- Login Form -->
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label class="form-label" for="username"
                            >Tên đăng nhập</label
                        >
                        <div class="input-wrapper">
                            <svg
                                class="input-icon"
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                                ></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                class="form-input"
                                placeholder="Nhập tên đăng nhập"
                                required
                            />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="password">Mật khẩu</label
                        >
                        <div class="input-wrapper">
                            <svg
                                class="input-icon"
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <rect
                                    x="3"
                                    y="11"
                                    width="18"
                                    height="11"
                                    rx="2"
                                    ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <input
                                type="password"
                                id="password"
                                name="password"
                                class="form-input"
                                placeholder="Nhập mật khẩu"
                                required
                            />
                            <button
                                type="button"
                                class="toggle-password"
                                id="togglePassword"
                            >
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                                    ></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <button
                        type="submit"
                        class="btn btn-primary btn-login"
                        id="loginBtn"
                    >
                        <span class="btn-text">Đăng nhập</span>
                        <span class="btn-loader hidden">
                            <svg
                                class="spinner-icon"
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                            >
                                <circle
                                    cx="12"
                                    cy="12"
                                    r="10"
                                    stroke="currentColor"
                                    stroke-width="3"
                                    fill="none"
                                    opacity="0.25"></circle>
                                <path
                                    d="M12 2a10 10 0 0 1 10 10"
                                    stroke="currentColor"
                                    stroke-width="3"
                                    fill="none"
                                    stroke-linecap="round"></path>
                            </svg>
                        </span>
                    </button>
                </form>

                <div class="login-footer">
                    <p>Chưa có tài khoản? <a href="/register">Đăng ký</a></p>
                </div>
            </div>
        </div>

        <style>
            @import "../styles/global.css";

            body {
                margin: 0;
                overflow: hidden;
            }

            .login-container {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem;
                position: relative;
                background: var(--bg-dark);
            }

            /* Background Effects */
            .bg-effects {
                position: absolute;
                inset: 0;
                overflow: hidden;
                pointer-events: none;
            }

            .gradient-orb {
                position: absolute;
                border-radius: 50%;
                filter: blur(100px);
                opacity: 0.5;
                animation: float 20s ease-in-out infinite;
            }

            .orb-1 {
                width: 600px;
                height: 600px;
                background: linear-gradient(
                    135deg,
                    var(--primary),
                    var(--primary-dark)
                );
                top: -200px;
                right: -100px;
                animation-delay: -5s;
            }

            .orb-2 {
                width: 500px;
                height: 500px;
                background: linear-gradient(
                    135deg,
                    var(--secondary),
                    var(--secondary-dark)
                );
                bottom: -150px;
                left: -100px;
                animation-delay: -10s;
            }

            .orb-3 {
                width: 300px;
                height: 300px;
                background: linear-gradient(135deg, #22c55e, #16a34a);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                animation-delay: -15s;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translate(0, 0) scale(1);
                }
                25% {
                    transform: translate(30px, -30px) scale(1.1);
                }
                50% {
                    transform: translate(-20px, 20px) scale(0.95);
                }
                75% {
                    transform: translate(20px, 10px) scale(1.05);
                }
            }

            /* Login Card */
            .login-card {
                width: 100%;
                max-width: 420px;
                background: rgba(30, 41, 59, 0.8);
                backdrop-filter: blur(20px);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-xl);
                padding: 2.5rem;
                position: relative;
                z-index: 10;
                animation: slideUp 0.5s ease-out;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .login-header {
                text-align: center;
                margin-bottom: 2rem;
            }

            .logo {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }

            .logo-icon {
                font-size: 2rem;
            }

            .logo h1 {
                font-size: 1.75rem;
                font-weight: 700;
                background: linear-gradient(
                    135deg,
                    var(--primary-light),
                    var(--secondary)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin: 0;
            }

            .subtitle {
                color: var(--text-secondary);
                font-size: 0.9375rem;
            }

            /* Alert */
            .alert-container {
                margin-bottom: 1rem;
            }

            .alert-container:empty {
                display: none;
            }

            /* Form */
            .login-form {
                display: flex;
                flex-direction: column;
                gap: 1.25rem;
            }

            .input-wrapper {
                position: relative;
                display: flex;
                align-items: center;
            }

            .input-icon {
                position: absolute;
                left: 1rem;
                color: var(--text-muted);
                pointer-events: none;
            }

            .form-input {
                padding-left: 3rem;
                padding-right: 3rem;
            }

            .toggle-password {
                position: absolute;
                right: 0.75rem;
                background: none;
                border: none;
                color: var(--text-muted);
                cursor: pointer;
                padding: 0.25rem;
                transition: var(--transition-fast);
            }

            .toggle-password:hover {
                color: var(--text-primary);
            }

            .btn-login {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                margin-top: 0.5rem;
            }

            .btn-loader {
                display: flex;
                align-items: center;
            }

            .spinner-icon {
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .login-footer {
                text-align: center;
                margin-top: 1.5rem;
                padding-top: 1.5rem;
                border-top: 1px solid var(--border-color);
            }

            .login-footer p {
                font-size: 0.875rem;
                margin: 0;
            }

            .login-footer a {
                color: var(--primary-light);
                font-weight: 500;
            }

            .login-footer a:hover {
                text-decoration: underline;
            }

            .hidden {
                display: none !important;
            }
        </style>

        <script>
            const API_URL = "http://localhost:2992/api";

            // Check if already logged in
            const token = localStorage.getItem("token");
            if (token) {
                window.location.href = "/admin";
            }

            // Toggle password visibility
            document
                .getElementById("togglePassword")
                ?.addEventListener("click", function () {
                    const passwordInput = document.getElementById(
                        "password",
                    ) as HTMLInputElement;
                    if (passwordInput.type === "password") {
                        passwordInput.type = "text";
                    } else {
                        passwordInput.type = "password";
                    }
                });

            // Show alert
            function showAlert(message: string, type: "success" | "error") {
                const container = document.getElementById("alertContainer");
                if (!container) return;

                const icon =
                    type === "success"
                        ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>'
                        : '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>';

                container.innerHTML = `
        <div class="alert alert-${type}">
          ${icon}
          <span>${message}</span>
        </div>
      `;

                // Auto hide after 5 seconds
                setTimeout(() => {
                    container.innerHTML = "";
                }, 5000);
            }

            // Handle form submit
            document
                .getElementById("loginForm")
                ?.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const loginBtn = document.getElementById("loginBtn");
                    const btnText = loginBtn?.querySelector(".btn-text");
                    const btnLoader = loginBtn?.querySelector(".btn-loader");

                    const username = (
                        document.getElementById("username") as HTMLInputElement
                    ).value;
                    const password = (
                        document.getElementById("password") as HTMLInputElement
                    ).value;

                    // Show loading
                    if (btnText) btnText.classList.add("hidden");
                    if (btnLoader) btnLoader.classList.remove("hidden");
                    if (loginBtn) loginBtn.setAttribute("disabled", "true");

                    try {
                        const response = await fetch(`${API_URL}/auth/login`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ username, password }),
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Save token and user info
                            localStorage.setItem("token", data.token);
                            localStorage.setItem(
                                "user",
                                JSON.stringify(data.user),
                            );

                            showAlert(
                                "Đăng nhập thành công! Đang chuyển hướng...",
                                "success",
                            );

                            // Redirect to admin
                            setTimeout(() => {
                                window.location.href = "/admin";
                            }, 1000);
                        } else {
                            showAlert(
                                data.error || "Đăng nhập thất bại!",
                                "error",
                            );
                        }
                    } catch (error) {
                        showAlert("Không thể kết nối đến server!", "error");
                    } finally {
                        // Hide loading
                        if (btnText) btnText.classList.remove("hidden");
                        if (btnLoader) btnLoader.classList.add("hidden");
                        if (loginBtn) loginBtn.removeAttribute("disabled");
                    }
                });
        </script>
    </body>
</html>
