---
// Admin Layout - Used for all admin pages
import "../styles/global.css";

interface Props {
  title: string;
  activeMenu?: string;
}

const { title, activeMenu = "dashboard" } = Astro.props;
---

<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} | MimirPrompt Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="admin-layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <span class="logo-icon">✨</span>
            <span class="logo-text">MimirPrompt</span>
          </div>
        </div>

        <nav class="sidebar-nav">
          <a
            href="/admin"
            class={`nav-item ${activeMenu === "dashboard" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="7" height="7" rx="1"></rect>
              <rect x="14" y="3" width="7" height="7" rx="1"></rect>
              <rect x="14" y="14" width="7" height="7" rx="1"></rect>
              <rect x="3" y="14" width="7" height="7" rx="1"></rect>
            </svg>
            <span>Dashboard</span>
          </a>
          <a
            href="/admin/prompts"
            class={`nav-item ${activeMenu === "prompts" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <path d="M14 2v6h6"></path>
              <path d="M16 13H8"></path>
              <path d="M16 17H8"></path>
              <path d="M10 9H8"></path>
            </svg>
            <span>Prompts</span>
          </a>
          <a
            href="/admin/tags"
            class={`nav-item ${activeMenu === "tags" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
            <span>Tags</span>
          </a>
          <a
            href="/admin/authors"
            class={`nav-item ${activeMenu === "authors" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Tác giả</span>
          </a>
          <a
            href="/admin/categories"
            class={`nav-item ${activeMenu === "categories" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
              ></path>
            </svg>
            <span>Danh mục</span>
          </a>
          <a
            href="/admin/audit"
            class={`nav-item ${activeMenu === "audit" ? "active" : ""}`}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"
              ></path>
            </svg>
            <span>Lịch sử thay đổi</span>
          </a>
        </nav>

        <div class="sidebar-footer">
          <button class="nav-item theme-toggle" id="themeToggle">
            <svg
              class="theme-icon sun"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg
              class="theme-icon moon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <span class="theme-label">Chế độ sáng</span>
          </button>
          <button class="nav-item logout-btn" id="logoutBtn">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Đăng xuất</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="top-header">
          <h1 class="page-title">{title}</h1>
          <div class="header-actions">
            <div class="user-info">
              <span class="user-name" id="userName">Admin</span>
              <div class="user-avatar">A</div>
            </div>
          </div>
        </header>

        <div class="content-wrapper">
          <slot />
        </div>
      </main>
    </div>

    <style>
      /* CSS Variables for Admin */
      :root {
        --primary: #6366f1;
        --primary-light: #818cf8;
        --primary-dark: #4f46e5;
        --secondary: #ec4899;
        --success: #22c55e;
        --warning: #f59e0b;
        --error: #ef4444;
        --bg-dark: #0f172a;
        --bg-card: #1e293b;
        --bg-hover: #334155;
        --bg-secondary: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --border-color: #334155;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
        --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
        --transition: all 0.2s ease;
      }

      /* Table Styles */
      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        background: rgba(51, 65, 85, 0.5);
      }

      td {
        font-size: 0.875rem;
        color: var(--text-primary);
      }

      tr:hover td {
        background: rgba(51, 65, 85, 0.3);
      }

      /* Card */
      .card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        overflow: hidden;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
      }

      .card-title {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
      }

      /* Badge */
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 600;
        background: rgba(99, 102, 241, 0.15);
        color: var(--primary-light);
        border-radius: 9999px;
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        text-decoration: none;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-glow);
      }

      .btn-secondary {
        background: var(--bg-hover);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: var(--bg-card);
        border-color: var(--primary);
      }

      .btn-danger {
        background: rgba(239, 68, 68, 0.15);
        color: var(--error);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .btn-danger:hover {
        background: var(--error);
        color: white;
      }

      .btn-sm {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }

      /* Pagination Styles */
      .pagination {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        gap: 8px !important;
        padding: 20px 16px !important;
        border-top: 1px solid var(--border-color) !important;
        flex-wrap: wrap !important;
      }

      .pagination-btn {
        min-width: 40px !important;
        height: 40px !important;
        padding: 0 14px !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        background: var(--bg-card) !important;
        border: 2px solid var(--border-color) !important;
        border-radius: 8px !important;
        color: var(--text-primary) !important;
        cursor: pointer !important;
        transition: all 0.15s ease !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
      }

      .pagination-btn:hover:not(:disabled):not(.active) {
        background: var(--bg-hover) !important;
        border-color: var(--primary) !important;
        color: var(--primary-light) !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
      }

      .pagination-btn.active {
        background: var(--primary) !important;
        color: white !important;
        border-color: var(--primary) !important;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4) !important;
      }

      .pagination-btn:disabled {
        opacity: 0.4 !important;
        cursor: not-allowed !important;
      }

      .goto-page {
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
        margin-left: 16px !important;
        padding-left: 16px !important;
        border-left: 2px solid var(--border-color) !important;
      }

      .goto-page label {
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        color: var(--text-secondary) !important;
      }

      .goto-page input {
        width: 60px !important;
        height: 36px !important;
        padding: 0 10px !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        background: var(--bg-hover) !important;
        border: 2px solid var(--border-color) !important;
        border-radius: 8px !important;
        color: var(--text-primary) !important;
        text-align: center !important;
      }

      .goto-page input:focus {
        outline: none !important;
        border-color: var(--primary) !important;
      }

      .goto-page button {
        height: 36px !important;
        padding: 0 14px !important;
        font-size: 0.8125rem !important;
        font-weight: 600 !important;
        background: var(--primary) !important;
        border: none !important;
        border-radius: 8px !important;
        color: white !important;
        cursor: pointer !important;
      }

      .goto-page button:hover {
        background: var(--primary-dark) !important;
      }

      /* Spinner */
      .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid var(--border-color);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Utilities */
      .text-center {
        text-align: center;
      }
      .text-muted {
        color: var(--text-muted);
      }

      /* Alert */
      .alert {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border-radius: var(--radius-md);
        margin-bottom: 1rem;
      }

      .alert-success {
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.15);
        color: var(--error);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      /* Modal */
      .modal-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background: rgba(0, 0, 0, 0.7) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 9999 !important;
        backdrop-filter: blur(4px);
      }

      .modal-overlay.hidden {
        display: none !important;
      }

      .modal {
        background: var(--bg-card) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: var(--radius-lg) !important;
        padding: 1.5rem !important;
        width: 90% !important;
        max-width: 500px !important;
        max-height: 90vh !important;
        overflow-y: auto !important;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5) !important;
        position: relative !important;
      }

      .admin-layout {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 260px;
        background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        z-index: 100;
      }

      .sidebar-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo-icon {
        font-size: 1.5rem;
      }

      .logo-text {
        font-size: 1.25rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--secondary)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .sidebar-nav {
        flex: 1;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        color: var(--text-secondary);
        border-radius: var(--radius-md);
        transition: var(--transition);
        text-decoration: none;
        border: none;
        background: none;
        width: 100%;
        cursor: pointer;
        font-size: 0.9375rem;
      }

      .nav-item:hover {
        background: var(--bg-hover);
        color: var(--text-primary);
      }

      .nav-item.active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        box-shadow: var(--shadow-glow);
      }

      .sidebar-footer {
        padding: 1rem;
        border-top: 1px solid var(--border-color);
      }

      .logout-btn {
        color: var(--error) !important;
      }

      .logout-btn:hover {
        background: rgba(239, 68, 68, 0.1) !important;
      }

      /* Theme Toggle */
      .theme-toggle {
        margin-bottom: 0.5rem;
      }

      .theme-icon {
        transition: var(--transition);
      }

      .theme-icon.moon {
        display: none;
      }

      [data-theme="light"] .theme-icon.sun {
        display: none;
      }

      [data-theme="light"] .theme-icon.moon {
        display: block;
      }

      /* Light Theme Variables */
      [data-theme="light"] {
        --bg-dark: #f8fafc;
        --bg-card: #ffffff;
        --bg-hover: #e2e8f0;
        --bg-secondary: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --text-muted: #94a3b8;
        --border-color: #e2e8f0;
      }

      [data-theme="light"] .sidebar {
        background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
      }

      [data-theme="light"] .main-content {
        background: var(--bg-dark);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 260px;
        min-height: 100vh;
        background: var(--bg-dark);
      }

      .top-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.5rem 2rem;
        background: var(--bg-card);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 50;
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .user-name {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .user-avatar {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
      }

      .content-wrapper {
        padding: 2rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .main-content {
          margin-left: 0;
        }
      }
    </style>

    <script>
      // Check auth on page load
      const token = localStorage.getItem("token");
      if (!token && !window.location.pathname.includes("/login")) {
        window.location.href = "/login";
      }

      // Display username
      const userInfo = localStorage.getItem("user");
      if (userInfo) {
        const user = JSON.parse(userInfo);
        const userNameEl = document.getElementById("userName");
        const userAvatarEl = document.querySelector(".user-avatar");
        if (userNameEl) userNameEl.textContent = user.username;
        if (userAvatarEl)
          userAvatarEl.textContent = user.username.charAt(0).toUpperCase();
      }

      // Logout
      document.getElementById("logoutBtn")?.addEventListener("click", () => {
        localStorage.removeItem("token");
        localStorage.removeItem("user");
        window.location.href = "/login";
      });

      // Theme Toggle
      function initTheme() {
        const savedTheme = localStorage.getItem("theme") || "dark";
        document.documentElement.setAttribute("data-theme", savedTheme);
        updateThemeLabel(savedTheme);
      }

      function updateThemeLabel(theme: string) {
        const label = document.querySelector(".theme-label");
        if (label) {
          label.textContent = theme === "dark" ? "Chế độ sáng" : "Chế độ tối";
        }
      }

      document.getElementById("themeToggle")?.addEventListener("click", () => {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
        updateThemeLabel(newTheme);
      });

      initTheme();
    </script>
  </body>
</html>
